title "System Configuration Changes"
label "Changes"
summary {Allows user to apply or discard system configuration changes}

accesslevel admin

storage none

help {
	This page indicates when system configuration changes have been made and
	are pending activation. The user can choose to apply or discard the
	configuration changes.
}

bar "System Configuration Changes"

# This hidden field allows us to return to the originating page after
# applying or discarding the changes
field page {
	stdmode hidden
	storage page
}

text {
	display {
		if {[is_modified]} {
			cgi display row {
				html eval p class=noteheading {
					html tag img src=/img/modified.png
					html str span "Configuration Modified"
				}
				html str p {
					The system configuration has been modified. Please select
					whether to apply or discard changes.
				}
			}
		} else {
			cgi display row {
				html str p {
					There are no system configuration changes pending.
				}
			}
		}
	}
}

button apply {
	label Apply
	help {Apply the system configuration changes}
	display {
		if {![is_modified]} {
			cgi addattrs disabled
		}
	}

	submit {
		if {[is_modified]} {
			exec config-apply-changes -agent "[cgi auth username] via web"

			# REVISIT: if we redirect with 'cgi nextpage' here, we
			# don't get to see the success message!
			cgi success "Changes successfully applied"
			if {[cgi get page] ne ""} {
				cgi nextpage [cgi get page]
			}
		}
	}
}

button discard {
	label Discard
	help {Discard the system configuration changes}

	display {
		if {![is_modified]} {
			cgi addattrs disabled
		}
	}

	submit {
		if {[is_modified]} {
			exec config-apply-changes -discard -agent "[cgi auth username] via web"
			# REVISIT: if we redirect with 'cgi nextpage' here, we
			# don't get to see the success message!
			cgi success "Changes successfully discarded"
			if {[cgi get page] ne ""} {
				cgi nextpage [cgi get page]
			}
		}
	}
}
