label "Mode"
title "Modem and RF/ODU Mode Settings"
help {Common modem and RF/ODU mode configuration}
head {
<style>
div.elemlabel { width: 8em; }
</style>
}

accesslevel link

ifmodified_message

bar "Modem/RF/ODU Mode Settings"

text {
	display display_page_help
}

field mode {
	storagename modem.mode
	stdmode hidden
	editmode hidden
}

field modem1 {
	storagename modem1.enabled
	stdmode hidden
	editmode hidden
}

field modem2 {
	storagename modem2.enabled
	stdmode hidden
	editmode hidden
}

set MODEDISP {110 "1+0 (Single Link)" 111 "2+0 (Two Independent Links)" 011 "1+1 (Hot Standby)"}

field modedisp {
	label "Mode"
	help {Select the operating mode of this device. i.e. whether one or two
	modems are operating independently or in hot-standby}
	storage none
	type {enum 110 111 011}
	stdmode [list enum {*}$MODEDISP]
	editmode [list radio {*}$MODEDISP] {onchange=javascript:set_mode()}
	display {
		cgi set $field [cgi get mode][cgi get modem1][cgi get modem2]
		display_field_help
	}
}

set HSMODE {auto "Auto" 1 "Force Modem 1" 2 "Force Modem 2"}
field hsmode {
	label "Hot Standby"
	help {Select whether Hot Standby will operate normally or if a specific modem should be used}
	storagename modem.hsmode
	type {enum auto 1 2}
	stdmode [list enum {*}$HSMODE]
	editmode [list select {*}$HSMODE]
	default auto
	display {
		cgi addattrs -container id="hsmode_row"
		display_field_help
	}
}

button submit {
	label Submit
	stdmode none
	submit {
		lassign [split [cgi get modedisp] ""] mode modem1 modem2

		cgi set mode $mode
		cgi set modem1 $modem1
		cgi set modem2 $modem2

		save_config
	}
}

button edit {
	label Edit
	editmode none
	setmode edit
}
button cancel {
	label Cancel
	stdmode none
}

text {
	display {
		html eval script type=text/javascript {
			# Show/hide hsmode based on mode.
			# Note that this is different for a radio botton than for a select list
			if {[cgi mode edit]} {
				html puts {
					function set_mode()
					{
						show_hide_elements(document.form.modedisp[2].checked, 'hsmode_row');
					}
				}
			} else {
				html puts {
					function set_mode()
					{
						show_hide_elements(document.form.modedisp.value == '011', 'hsmode_row');
					}
				}
			}

			html puts {set_mode();}
		}
	}
}

# vim: se ts=4:
