label "Debug Status"
title "Debug Status"

accesslevel support

storage page

summary {Display system debug status}

field type {
	stdmode hidden
	default 0
}

init {
	set pages {
		{"Modem" "Modem Status" show-modem-regs}
		{"RF" "RF Status" show-rf-info}
		{"Global" "Global Status" show-global-regs}
		{"Link Control" "Link Control Status" show-super-info}
		{"Network" "Network Status" show-mgmt-info show-net-status show-net-stats}
		{"VLAN Status" "Switch VLAN Status" {vlanconfig show} {vlanconfig modes} {vlanconfig violations}}
		{"Web" "Web Status" {session-key -list}}
		{"Equaliser" "Equaliser Taps" {equaliser-taps -dfe 1} {equaliser-taps -timing 1} {equaliser-taps -dfe 2} {equaliser-taps -timing 2}}
		{"Config" "Configuration" show-config}
		{"Version" "Version Info" {support-report -short}}
	}
}

display {
	# Dynamically display tabs
	set tabinfo {}
	set n 0
	foreach p $pages {
		set commands [lassign $p label title]
		lappend tabinfo [cgi href $page type $n] $label
		incr n
	}
	cgi tabs [cgi get type] $tabinfo

	# Find the page info
	set type [cgi get type]
	set commands [lassign [lindex $pages $type] label title]

	# Display it
	cgi display row {
		html str div class=bar $title
	}
	cgi display row {
		foreach command $commands {
			html str pre "# [join $command { }]"
			html str pre [exec {*}$command]
		}
	}
}

# This is a macro to enable auto-refresh on this page
auto_refresh_page type
